<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Adaptive Mesh Refinement Tutorial" href="AutoMeshGuide.html" /><link rel="prev" title="Optimal Control Problem Tutorial" href="OptimalControlProblem.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.07.26 -->
        <title>PSIOPT - ASSET 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=369552022d0b975c8e74270ce6eabe0fb7978f24" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ASSET 0.2.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/ASSETLOGO.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ASSET 0.2.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Install.html">Installing ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="VectorFunctionGuide.html">Vector Function Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="ODEGuide.html">ODE Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="IntegratorGuide.html">Integrator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="PhaseGuide.html">Optimal Control Phase Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlProblem.html">Optimal Control Problem Tutorial</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">PSIOPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="AutoMeshGuide.html">Adaptive Mesh Refinement Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlUtilites.html">Optimal Control Utilities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/Delta3.html">Delta 3 Multi-phase GTO Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/ReentryExample.html">Space Shuttle Reentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/CartPole.html">Cart-Pole Swing Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/HyperSensitive.html">Hyper-Sensitive Optimal Control Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/halo.html">Orbit Family Continuation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelo.html">Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelolink.html">Multi-Phase Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/MultiTarg.html">Multi-Spacecraft Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python/python.html">Python Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Python Library Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../python/asset.html">ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/optimalcontrol.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/vectorfunctions.html">Vector Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/Astro.html">ASSET Astro Library</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="psiopt">
<span id="psiopt-guide"></span><h1>PSIOPT<a class="headerlink" href="#psiopt" title="Permalink to this heading">#</a></h1>
<p>Having an efficient method of solving sparse non-linear optimization problems is critical to the success of any trajectory optimization software.
While several excellent optimization software packages exist, they all require either commercial products (KNITRO, SNOPT) or are reliant
on other commercial and restrictively licensed products for optimum performance (IPOPT).
Therefore, in order to keep ASSET completely open source, the Parallel Sparse Interior-point Optimizer (PSIOPT) was developed and incorporated into the library.
PSIOPT is built to solve non-linear programs (NLP) expressed in standard form as shown in <a class="reference internal" href="PhaseGuide.html#eq-1"><span class="std std-ref">Eq.(1)</span></a>.</p>
<div class="math-wrapper docutils container" id="eq-1">
<span id="equation-eq-1"></span><div class="math notranslate nohighlight" id="eq-1">
<span id="equation-eq-1"></span><span class="eqno">(1)<a class="headerlink" href="#eq-1" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}min:f(\vec{x})\\\vec{h}(\vec{x})=\vec{0}\\\vec{g}(\vec{x})&lt;\vec{0}{}\end{aligned}\end{align} \]</div>
</div>
<p>In short, it seeks to minimize a scalar valued objective function <span class="math notranslate nohighlight">\(f(\vec{x})\)</span> of design variables, <span class="math notranslate nohighlight">\(\vec{x}\)</span>, subject to equality, <span class="math notranslate nohighlight">\(\vec{h}(\vec{x})\)</span>,
and an inequality, <span class="math notranslate nohighlight">\(\vec{g}(\vec{x})\)</span>, constraints on those variables. PSIOPT adopts a primal-dual-interior-point approach to convert the problem into
an equivalent bound constrained saddle-point optimization problem of the Lagrangian function defined in <a class="reference internal" href="#eq-2"><span class="std std-ref">Eq.(2)</span></a>.</p>
<div class="math-wrapper docutils container" id="eq-2">
<span id="equation-eq-2"></span><div class="math notranslate nohighlight" id="eq-2">
<span id="equation-eq-2"></span><span class="eqno">(2)<a class="headerlink" href="#eq-2" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}L(\vec{x},\vec{s},\vec{\nu},\vec{\lambda}) = f(\vec{x}) - \mu \sum \ln (s_i) + \vec{h}(\vec{x})\cdot\vec{\nu} + (\vec{g}(\vec{x}) + \vec{s})\cdot\vec{\lambda}\\\vec{s}&gt;\vec{0}\quad\quad\quad\quad \vec{\lambda}&gt;\vec{0}\quad\quad\quad\quad \mu&gt;0\quad\quad\quad\quad\end{aligned}\end{align} \]</div>
</div>
<p>Additional non-negative slack variables, <span class="math notranslate nohighlight">\(\vec{s}\)</span>, are added to each inequality constraint to capture the distance from the constraint boundary.
An additional term, the barrier objective, is then added that penalizes solutions near the edge of the feasible region by taking the negative log of each slack variable.
The barrier objective is modulated by the single barrier term, <span class="math notranslate nohighlight">\(\mu\)</span>, which is adaptively reduced throughout the optimization process to allow for active inequality constraints
to approach the boundary of the feasible region. In addition, Lagrange multipliers are added for the equality, <span class="math notranslate nohighlight">\(\vec{\nu}\)</span>, and inequality, <span class="math notranslate nohighlight">\(\vec{\lambda}\)</span> constraints and
appended to the Lagrangian. The solver then seeks stationary points of the Lagrangian function using a full-space Newton method. The iteration matrix can be seen in <a class="reference internal" href="#eq-3"><span class="std std-ref">Eq.(3)</span></a> below. Similar
to IPOPT, a positive multiple of the identity matrix is added to the Hessian of the Lagrangian to ensure that the iteration matrix has the correct inertia signature at each iteration. The algorithm
will update <span class="math notranslate nohighlight">\(\delta\)</span> every iteration to keep this perturbation as small as possible.</p>
<div class="math-wrapper docutils container" id="eq-3">
<span id="equation-eq-3"></span><div class="math notranslate nohighlight" id="eq-3">
<span id="equation-eq-3"></span><span class="eqno">(3)<a class="headerlink" href="#eq-3" title="Permalink to this equation">#</a></span>\[ \begin{align}\begin{aligned}\begin{split}\begin{bmatrix}
H &amp; 0 &amp; \nabla_x h  &amp; \nabla_x g  \\
0 &amp; \frac{\lambda}{s} &amp; 0 &amp; I\\
\nabla_x h^T &amp; 0 &amp; 0 &amp; 0\\
\nabla_x g^T &amp; I &amp; 0 &amp; 0
\end{bmatrix}
\begin{bmatrix}
dx\\ds\\d\nu\\d\lambda
\end{bmatrix}=-
\begin{bmatrix}
\nabla_x f + \nabla_x h \cdot \nu + \nabla_x g \cdot \lambda\\
\lambda -\frac{\mu}{s}\\
h\\
g+s
\end{bmatrix}\end{split}\\
H = \nabla_{_{xx}}f + \nabla_{_{xx}}h\cdot\nu + \nabla_{_{xx}}g\cdot\lambda + \delta I\end{aligned}\end{align} \]</div>
</div>
<p>The first and second derivatives of the objectives and constraints appearing in <a class="reference internal" href="#eq-3"><span class="std std-ref">Eq.(3)</span></a> are calculated analytically by ASSET’s VectorFunction type system.
Since computation of first and second derivatives is a computationally expensive task, the solver automatically detects independent functions and evaluate them in parallel on multi-core CPUs.
To solve the resulting linear-system, the software leverages the state of the art sparse-symmetric-indefinite solver MKL PARDISO.</p>
<section id="psiopt-usage">
<h2>PSIOPT Usage<a class="headerlink" href="#psiopt-usage" title="Permalink to this heading">#</a></h2>
<p>Each interface for defining optimization problems in ASSET (ex: <code class="code docutils literal notranslate"><span class="pre">OptimalControlProblem</span></code>, <code class="code docutils literal notranslate"><span class="pre">ode.phase</span></code> )
has as its own instance of PSIOPT attached as a member variable of the class.
Formulation and solution of the optimization problem is always handled through the respective interface,
but users can use this reference to modify PSIOPT’s settings . A list of common settings
and their default and suggested values are listed in the table below. In all cases these can be set by using the <code class="code docutils literal notranslate"><span class="pre">.set_XXX(value)</span></code> method
where <code class="code docutils literal notranslate"><span class="pre">XXX</span></code> is replaced by the name of the setting</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset_asrl</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="n">ocp</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span><span class="o">.</span><span class="n">OptimalControlProblem</span><span class="p">()</span>

<span class="c1"># Define problem</span>
<span class="c1"># .</span>
<span class="c1"># .</span>
<span class="c1"># .</span>

<span class="n">ocp</span><span class="o">.</span><span class="n">optimizer</span> <span class="c1">## Reference to ocp&#39;s psiopt instance</span>

<span class="n">ocp</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">set_MaxIters</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ocp</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">set_OptLSMode</span><span class="p">(</span><span class="s2">&quot;AUGLANG&quot;</span><span class="p">)</span>
<span class="n">ocp</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">set_BoundFraction</span><span class="p">(</span><span class="mf">.99</span><span class="p">)</span>
</pre></div>
</div>
<div class="table-wrapper colwidths-given docutils container" id="id1">
<table class="docutils align-default" id="id1" style="width: 100%">
<caption><span class="caption-text">PSIOPT SETTINGS</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 50%" />
<col style="width: 17%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description/Tips</p></th>
<th class="head"><p>(type) Default Value</p></th>
<th class="head"><p>(Valid)/[Suggested] Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MaxIters</p></td>
<td><p>Maximum number of iterations the solve or optimization routines will run before returning with NO SOLUTION FOUND.</p></td>
<td><p>(int) 500</p></td>
<td><p>(&gt;0) [100,1000]</p></td>
</tr>
<tr class="row-odd"><td><p>MaxAccIters</p></td>
<td><p>Maximum number of consecutive acceptable iterations the solve or optimization routines will run before returning with ACCEPTABLE SOLUTION FOUND.
An acceptable iterate is defined as having EconsInf,IConsInf,KKTinf, and all being less than their specified acceptable value (Acc###tol). To disable
acceptable solutions set this to be greater than or equal to MaxIters.</p></td>
<td><p>(int) 50</p></td>
<td><p>(&gt;0) [50,300]</p></td>
</tr>
<tr class="row-even"><td><p>###tol
(### = KKT,ECon,ICon,Bar)</p></td>
<td><p>Convergence tolerances for the KKT/optimality, equality, inequality, and barrier infeasibilities.</p></td>
<td><p>(double) 1.0e-6</p></td>
<td><p>(&gt;0.0) [1.0e-6,1.0e-12]</p></td>
</tr>
<tr class="row-odd"><td><p>Acc###tol
(### = KKT,ECon,ICon,Bar)</p></td>
<td><p>Acceptable convergence tolerances for the KKT/optimality, equality, inequality, and barrier infeasibilities.</p></td>
<td><p>(double) 1.0e-3</p></td>
<td><p>(&gt;0.0) [1.0e-3,1.0e-5]</p></td>
</tr>
<tr class="row-even"><td><p>Div###tol
(### = KKT,ECon,ICon,Bar)</p></td>
<td><p>Diverging tolerances for the KKT/optimality, equality, inequality, and barrier infeasibilities. Algorithm will terminate with SOLUTION DIVERGING if value exceeds this number.</p></td>
<td><p>(double) 1.0e15</p></td>
<td><p>(&gt;0.0) [1.0e10,1.0e15]</p></td>
</tr>
<tr class="row-odd"><td><p>MaxLSIters</p></td>
<td><p>Maximum number iterations a line search algorithm will take before accepting the step and continuing to next full iteration.</p></td>
<td><p>(int) 2</p></td>
<td><p>(&gt;=0) [1,4]</p></td>
</tr>
<tr class="row-even"><td><p>alphaRed</p></td>
<td><p>Amount by which a line search algorithm divides the current step size when it fails to reduce the merit function.</p></td>
<td><p>(double) 2.0</p></td>
<td><p>(&gt;1.0) [1.5,3.0]</p></td>
</tr>
<tr class="row-odd"><td><p>OptLSMode</p></td>
<td><p>Line Search algorithm to be used by the optimization algorithm. It is disabled by default, but we suggest enabling the
L1 penalty function line search or Augmented Lagrangian line search for sensitive problems with poor initial guesses.</p></td>
<td><p>(string) ‘NOLS’</p></td>
<td><p>[‘AUGLANG’,’L1’,’NOLS’]</p></td>
</tr>
<tr class="row-even"><td><p>SoeLSMode</p></td>
<td><p>Line Search algorithm to be used by the solve algorithm. It is disabled by default.</p></td>
<td><p>(‘string’) ‘NOLS’</p></td>
<td><p>[‘AUGLANG’,’L1’,’NOLS’]</p></td>
</tr>
<tr class="row-odd"><td><p>OptBarMode</p></td>
<td><p>Adaptive barrier parameter method to be used by the optimization algorithm. Set to the LOQO centrality heuristic by default. The other option, ‘PROBE’,
is the Mehrotra probing heuristic. It can converge in fewer iterations than ‘LOQO’ in certain circumstances but requires an extra linear solve of the KKT matrix.
Thus it is typically slower than the LOQO algorithm.</p></td>
<td><p>(string) ‘LOQO’</p></td>
<td><p>[‘LOQO’,’PROBE’]</p></td>
</tr>
<tr class="row-even"><td><p>SoeBarMode</p></td>
<td><p>Adaptive barrier parameter method to be used by the solve algorithm. Set to the ‘LOQO’ centrality heuristic by default. The other option, ‘PROBE’,
is the Mehrotra probing heuristic. It can converge in fewer iterations than ‘LOQO’ in certain circumstances but requires an extra linear solve of the KKT matrix.
Thus it is typically slower than the ‘LOQO’ algorithm.</p></td>
<td><p>(string) ‘LOQO’</p></td>
<td><p>[‘LOQO’,’PROBE’]</p></td>
</tr>
<tr class="row-odd"><td><p>deltaH</p></td>
<td><p>Size of the first and smallest perturbation, <span class="math notranslate nohighlight">\(\delta\)</span>, that will be added to the diagonal of the KKT matrix to correct for indefiniteness.</p></td>
<td><p>(double) 1.0e-5</p></td>
<td><p>(&gt;0.0) [1.e-8,1.e-4]</p></td>
</tr>
<tr class="row-even"><td><p>incrH</p></td>
<td><p>Factor by which a the Hessian perturbation, <span class="math notranslate nohighlight">\(\delta\)</span>, will be increased when the previous value failed to correct the KKT matrix’s inertia.</p></td>
<td><p>(double) 8.0</p></td>
<td><p>(1.0) [4.0,10.0]</p></td>
</tr>
<tr class="row-odd"><td><p>decrH</p></td>
<td><p>Factor by which a the Hessian perturbation, <span class="math notranslate nohighlight">\(\delta\)</span>, will be decreased each iteration.</p></td>
<td><p>(double) .33</p></td>
<td><p>(&lt;1.0) [.1,.5]</p></td>
</tr>
<tr class="row-even"><td><p>BoundFraction</p></td>
<td><p>Fraction of the full step to the boundary that the slack variables or inequality constraint multipliers will take. Must be less
than 1.0 to prevent slacks and multipliers from becoming negative. Values close to one will lead to faster convergence when near the
solution but can harm robustness when the initial guess is poor.</p></td>
<td><p>(double) .98</p></td>
<td><p>(&lt;1.0) [.95,.999]</p></td>
</tr>
<tr class="row-odd"><td><p>QPOrderingMode</p></td>
<td><p>Fill-in reducing ordering applied to the KKT matrix by MKL-Pardiso. The default, ‘METIS’, is the METIS nested dissection algorithm
and generally results in the best scaling of matrix factorization with the number of threads. The alternative, “MINDEG”, the minimum degree algorithm, generally
results in faster single threaded factorizations, but does not scale well with thread count. Use “MINDEG” when using Jet and “METIS” otherwise.</p></td>
<td><p>(string) “METIS”</p></td>
<td><p>[“METIS”,”MINDEG”]</p></td>
</tr>
<tr class="row-even"><td><p>PrintLevel</p></td>
<td><p>Verbosity of the console output. 0 is full output, and higher values will produce less output. Set to 3 or higher for no output.</p></td>
<td><p>(int) 0</p></td>
<td><p>[&gt;= 0]</p></td>
</tr>
</tbody>
</table>
</div>
<p>After defining a problem, and potentially modifying the optimizer settings, an optimization problem interface is used to invoke one of or a sequence of PSIOPT’s algorithms as
shown below. The <code class="code docutils literal notranslate"><span class="pre">optimize</span></code> algorithm will seek to minimize the objective function and also satisfy the equality and inequality constraints. The <code class="code docutils literal notranslate"><span class="pre">solve</span></code> algorithm ignores the objective and
attempts only to find a solution to the equality and inequality constraints. If you are only trying to solve a system of equations and do not have an objective
function, you should almost always use the <code class="code docutils literal notranslate"><span class="pre">solve</span></code> algorithm rather than invoking <code class="code docutils literal notranslate"><span class="pre">optimize</span></code>.
You may also invoke the <code class="code docutils literal notranslate"><span class="pre">solve</span></code> and <code class="code docutils literal notranslate"><span class="pre">optimize</span></code> algorithms in sequence
using <code class="code docutils literal notranslate"><span class="pre">solve_optimize</span></code> as shown below. For example, it can often be more robust to call <code class="code docutils literal notranslate"><span class="pre">solve</span></code> first when optimizing so that the <code class="code docutils literal notranslate"><span class="pre">optimize</span></code> algorithm will start from a feasible point.
Additionally, it often happens that the <code class="code docutils literal notranslate"><span class="pre">optimize</span></code> algorithm will be able to minimize the objective function considerably from its initial value,
but have difficulty exactly satisfying the optimality and constraint tolerances simultaneously.
In these cases, it is practical to feed this non-converged solution to the solve algorithm in the hopes of finding a nearby solution that satisfies the constraints.
For the combined call sequences, the function returns the convergence flag of the last algorithm invoked. If you need the convergence flag for each specific algorithm, they should be called
separately.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>    <span class="c1"># ocp transcribes problem and calls psiopt&#39;s solve algorithm</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span> <span class="c1"># ocp transcribes problem and calls psiopt&#39;s optimize algorithm</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">solve_optimize</span><span class="p">()</span>       <span class="c1"># Calls solve then optimize, functionally equivalent to calling the two lines above</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">solve_optimize_solve</span><span class="p">()</span> <span class="c1"># Calls solve then optimize, then calls solve IF optimize fails to converge</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">optimize_solve</span><span class="p">()</span>       <span class="c1"># Calls optimize, then calls solve IF optimize fails to converge</span>
</pre></div>
</div>
<p>The returned convergence flags are enumerator types defined in <code class="code docutils literal notranslate"><span class="pre">ast.Solvers.ConvergenceFlags</span></code>, and their meanings and integer values are given in the table below. Should you need to
use the flags in your code, it is recommended to compare flags to their enumerator rather than integer values as shown below, in case that we add more flags in the future.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Cflags</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Solvers</span><span class="o">.</span><span class="n">ConvergenceFlags</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">ocp</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>

<span class="k">if</span><span class="p">(</span><span class="n">flag</span><span class="o">==</span> <span class="n">Cflags</span><span class="o">.</span><span class="n">CONVERGED</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Success&quot;</span><span class="p">)</span>
<span class="k">elif</span><span class="p">(</span><span class="n">flag</span><span class="o">==</span> <span class="n">Cflags</span><span class="o">.</span><span class="n">ACCEPTABLE</span> <span class="ow">or</span> <span class="n">flag</span> <span class="o">==</span> <span class="n">Cflags</span><span class="o">.</span><span class="n">NOTCONVERGED</span><span class="p">):</span>
    <span class="n">ocp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="k">elif</span><span class="p">(</span><span class="n">flag</span><span class="o">==</span> <span class="n">Cflags</span><span class="o">.</span><span class="n">DIVERGING</span><span class="p">):</span>
    <span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
<div class="table-wrapper colwidths-given docutils container" id="id2">
<table class="docutils align-default" id="id2" style="width: 100%">
<caption><span class="caption-text">PSIOPT CONVERGENCE FLAGS</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 65%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Flag</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Integer Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CONVERGED</p></td>
<td><p>The algorithm fully converged to a solution satisfying user specified EContol,IContol, Bartol, and KKTtol (if optimizing).</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>ACCEPTABLE</p></td>
<td><p>The algorithm has terminated because it observed MaxAccIters number of consecutive iterates that all satisfy user specified AccEContol,AccIContol, AccBartol, and AccKKTtol (if optimizing).
This prevents the algorithm from iterating until MaxIters is reached, if full tolerances cannot be exactly satisfied, and no progress is being made.</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>NOTCONVERGED</p></td>
<td><p>The algorithm has run form MaxIters number of iterates with out finding a solution satisfying user specified EContol,IContol, Bartol, and KKTtol (if optimizing).</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>DIVERGING</p></td>
<td><p>The algorithm has terminated immediately because it encountered either a NaN, Inf, or number larger than the user specified DivEContol,DivIContol, DivBartol, and DivKKTtol in
constraints or gradient</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<section id="threading">
<h3>Threading<a class="headerlink" href="#threading" title="Permalink to this heading">#</a></h3>
<p>By default, PSIOPT will set the number of threads used to parallelize function evaluations to be equal to the number of hardware threads
on your machine up to a maximum of 16. So if your computer has 10 cores and 20 threads (ex: i9-10900k), only 16 threads will be used for function evaluations by default.
Likewise by default, PSIOPT will set the number of threads used to factor KKT matrices to be equal to the number of physical cores on your machine up to a maximum of 8.
So, if your computer has 10 cores and 20 threads, only 8 threads will be used for matrix factorization by default. Based on experience, this an appropriate
threading allocation to solve single problems as fast as possible on most desktop machines. In our experience KKT matrix factorization does not scale beyond
8 threads on most problems. Furthermore, applying too many threads to function evaluations on small to medium sized problems can actually degrade performance.
However, you can manually set the thread count by using the <code class="code docutils literal notranslate"><span class="pre">.setThreads</span></code> member function of a <code class="code docutils literal notranslate"><span class="pre">phase</span></code> or <code class="code docutils literal notranslate"><span class="pre">OptimalControlProblem</span></code>. If speed is of concern we recommend you play around with
these parameters to find the best option. However, we should note that if you are trying to maximize throughput by running ASSET in multiple processes simultaneously on your desktop or on a server,
you should almost always set the optimizer to run-serially to prevent over-subscription of the CPU.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phase</span><span class="o">.</span><span class="n">setThreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># force to run serially on a single thread only</span>
<span class="n">phase</span><span class="o">.</span><span class="n">solve_optimize</span><span class="p">()</span>


<span class="n">ocp</span><span class="o">.</span><span class="n">setThreads</span><span class="p">(</span><span class="n">FuncThreads</span> <span class="o">=</span> <span class="mi">20</span> <span class="p">,</span><span class="n">KKTThreads</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># Use more than default number of threads</span>
<span class="n">ocp</span><span class="o">.</span><span class="n">Phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setThreads</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>  <span class="c1">#not necessary, will be overridden by the settings of the ocp</span>
<span class="n">ocp</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="output">
<h3>Output<a class="headerlink" href="#output" title="Permalink to this heading">#</a></h3>
<p>When invoking one of PSIOPT’s algorithms with a <code class="code docutils literal notranslate"><span class="pre">PrintLevel</span></code> of 0, the solver will produce the console output scroll shown in the figure below. The current objective
and constraint/optimality errors as well as other relevant algorithm parameters are displayed at each iterate. The meaning of each column is given in the table below.
The constraint and optimality feasibilities are color coded according to their value. The color scheme progresses from dark red to orange, to yellow, to green as the
value of the feasibility approaches user specified tolerances. When the value is yellow the current value satisfies the corresponding Acc###tol and likewise when it is green it satisfies ###tol.
Additionally, the right hash mark of ‘Prim Obj’,’Barr Obj’,’KKT Inf’,’ECons Inf’, and ‘ICons Inf’ are color coded to show whether the current value is a decrease (green) or increase (red) from the previous iterate.
The full console is 119 characters wide, which will fit in a standard console on Windows. However, most Linux terminals are not wide enough by default, so you should widen your terminal if you want to be able to
make sense of the output. While the console is (in its author’s opinion) quite nice to look at, it has non-negligible cost to print, so you should probably suppress output if throughput and performance are of concern.
You can suppress some or all of the output by setting <code class="code docutils literal notranslate"><span class="pre">PrintLevel</span></code> to a value greater than 1.</p>
<a class="reference internal image-reference" href="../_images/PSIOPTOUT.PNG"><img alt="../_images/PSIOPTOUT.PNG" src="../_images/PSIOPTOUT.PNG" style="width: 100%;" /></a>
<div class="table-wrapper colwidths-given docutils container" id="id3">
<table class="docutils align-default" id="id3" style="width: 100%">
<caption><span class="caption-text">PSIOPT Print Output</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Mu Val</p></td>
<td><p>Value of the barrier parameter, <span class="math notranslate nohighlight">\(\mu\)</span> , at the current iterate .</p></td>
</tr>
<tr class="row-odd"><td><p>Prim Obj</p></td>
<td><p>Value of the primal objective, <span class="math notranslate nohighlight">\(f(\vec{x})\)</span> , at the current iterate .</p></td>
</tr>
<tr class="row-even"><td><p>Barr Obj</p></td>
<td><p>Value of the barrier objective, <span class="math notranslate nohighlight">\(- \mu \sum \ln (s_i)\)</span> , at the current iterate .</p></td>
</tr>
<tr class="row-odd"><td><p>KKT Inf</p></td>
<td><p>Value of the optimality(KKT) infeasibility, <span class="math notranslate nohighlight">\(| \nabla_x f + \nabla_x h \cdot \nu + \nabla_x g \cdot \lambda |_{\infty}\)</span> , at the current iterate .</p></td>
</tr>
<tr class="row-even"><td><p>Barr Inf</p></td>
<td><p>Value of the barrier infeasibility, <span class="math notranslate nohighlight">\(|\vec{s}\otimes\vec{\lambda}|_{\infty}\)</span> , at the current iterate.</p></td>
</tr>
<tr class="row-odd"><td><p>ECons Inf</p></td>
<td><p>Value of the equality constraint infeasibility, <span class="math notranslate nohighlight">\(|\vec{h}(\vec{x})|_{\infty}\)</span> , at the current iterate.</p></td>
</tr>
<tr class="row-even"><td><p>ICons Inf</p></td>
<td><p>Value of the inequality constraint infeasibility, <span class="math notranslate nohighlight">\(|\vec{g}(\vec{x}) + \vec{s}|_{\infty}\)</span> , at the current iterate.</p></td>
</tr>
<tr class="row-odd"><td><p>AlphaP</p></td>
<td><p>Step length of the primal and slack variables as determined by non-negativity constraints on <span class="math notranslate nohighlight">\(s\)</span>.</p></td>
</tr>
<tr class="row-even"><td><p>AlphaD</p></td>
<td><p>Step length of the equality and inequality dual variables as determined by non-negativity constraints on <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></td>
</tr>
<tr class="row-odd"><td><p>LSI</p></td>
<td><p>Number of Line search iterations.</p></td>
</tr>
<tr class="row-even"><td><p>PPS</p></td>
<td><p>Number of perturbed pivots seen during factorization of the KKT matrix.</p></td>
</tr>
<tr class="row-odd"><td><p>HFI</p></td>
<td><p>Number of Hessian factorization and regularization iterations needed to correct the inertia of the KKT matrix.</p></td>
</tr>
<tr class="row-even"><td><p>HPert</p></td>
<td><p>Final value of the Hessian perturbation that resulted in a successful matrix factorization.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="jet">
<h2>Jet<a class="headerlink" href="#jet" title="Permalink to this heading">#</a></h2>
<p>In addition to calling PSIOPT to solve or optimize a single problem at a time, we provide the capability to optimize multiple different problems in parallel using
the <code class="code docutils literal notranslate"><span class="pre">Jet</span></code> tool. This can allow you to more efficiently tackle throughput oriented workloads from within a single python process,
without having to resort to multiprocessing libraries. There are two ways to do this. In the first method, demonstrated below, we construct a python list
of fully configured phases or optimal control problems (or both) as we normally would, but rather than running solve or optimize on each individually, we specify the algorithm we would like Jet to invoke
using <code class="code docutils literal notranslate"><span class="pre">.setJetJobMode(&quot;&quot;)</span></code>. These options correspond to the methods we have already covered. Having set the job mode, we add the objects a list and then pass the list to the <code class="code docutils literal notranslate"><span class="pre">Jet.map()</span></code> function along with
the number of threads we want to use, and a bool specifying whether we want to print the console scroll. It is not necessary to set the number of threads for
each phase or optimal control problem, Jet will take care of optimally allocating the number of threads for each problem.
After solving all the problems, the function returns the list of phases/optimal control problems. We can then access
each element of the returned list to get the solved trajectories as we normally would. You can get the convergence flag of each problem by using the <code class="code docutils literal notranslate"><span class="pre">get_ConvergenceFlag()</span></code> method of the optimizer instance
attached to each problem.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset_asrl</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="n">solvers</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Solvers</span>
<span class="n">oc</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span>

<span class="n">ocps</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">):</span>

    <span class="n">ocp</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">OptimalControlProblem</span><span class="p">()</span>
    <span class="c1">#Define a problem</span>
    <span class="c1">#.</span>
    <span class="c1">#.</span>

    <span class="n">ocp</span><span class="o">.</span><span class="n">setThreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Not necessary, Jet will take care of this</span>

    <span class="c1">### SET the JetJobMode !!! #####</span>
    <span class="n">ocp</span><span class="o">.</span><span class="n">setJetJobMode</span><span class="p">(</span><span class="s2">&quot;optimize&quot;</span><span class="p">)</span>

    <span class="c1">#Or</span>
    <span class="c1">#ocp.setJetJobMode(&quot;solve&quot;)</span>
    <span class="c1">#Or</span>
    <span class="c1">#ocp.setJetJobMode(&quot;optimize_solve&quot;)</span>
    <span class="c1">#Or</span>
    <span class="c1">#ocp.setJetJobMode(&quot;solve_optimize&quot;)</span>
    <span class="c1">#Or</span>
    <span class="c1">#ocp.setJetJobMode(&quot;solve_optimize_solve&quot;)</span>
    <span class="c1">#Or</span>
    <span class="c1">#ocp.setJetJobMode(&quot;DoNothing&quot;)</span>

    <span class="n">ocps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ocp</span><span class="p">)</span>


<span class="n">Nthreads</span> <span class="o">=</span> <span class="mi">8</span>   <span class="c1"># Set to number of cores on machine for best performance</span>

<span class="n">PrintConsole</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">ocps</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">Jet</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ocps</span><span class="p">,</span><span class="n">Nthreads</span><span class="p">,</span><span class="n">PrintConsole</span><span class="p">)</span>

<span class="c1">### Access the solved phases/ocps</span>
<span class="n">ocps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">returnTraj</span><span class="p">()</span>

<span class="c1">## Get the convergence flag this way</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">ocps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">get_ConvergenceFlag</span><span class="p">()</span>
</pre></div>
</div>
<p>Alternatively, we can use another method shown below where we leverage a generator function. Rather than creating each phase/optimal control problem directly, we create
a function that returns them. We can then pass this function, along with a python list of tuples of the arguments we want to pass to our <code class="code docutils literal notranslate"><span class="pre">ProblemGenerator</span></code>
function. Internally, Jet will then expand each element of the <code class="code docutils literal notranslate"><span class="pre">ProblemArgs</span></code> list into the <code class="code docutils literal notranslate"><span class="pre">ProblemGenerator</span></code> function to create all of the phases/optimal control problems on the fly.
These will then be solved according the job mode and returned as a list as before. This form is particularly efficient whenever construction of each problem requires independent
and expensive preprocessing that cannot be parallelized.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset_asrl</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="n">solvers</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Solvers</span>
<span class="n">oc</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span>


<span class="k">as</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">bs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ProblemArgs</span> <span class="o">=</span><span class="p">[]</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="k">as</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">:</span>
        <span class="n">ProblemArgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">ProblemGenerator</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>

    <span class="n">ocp</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">OptimalControlProblem</span><span class="p">()</span>

    <span class="c1">#Define a problem based on inputs a,b</span>
    <span class="c1">#. Some Non Trivial Preprocessing</span>
    <span class="c1">#.</span>
    <span class="c1">#.</span>

    <span class="n">ocp</span><span class="o">.</span><span class="n">setThreads</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Not necessary, Jet will take care of this</span>

    <span class="c1">### SET the JetJobMode !!! #####</span>
    <span class="n">ocp</span><span class="o">.</span><span class="n">setJetJobMode</span><span class="p">(</span><span class="s2">&quot;optimize&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ocp</span>




<span class="n">Nthreads</span> <span class="o">=</span> <span class="mi">8</span>   <span class="c1"># Set to number of cores on machine for best performance</span>

<span class="n">PrintConsole</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">ocps</span> <span class="o">=</span> <span class="n">solvers</span><span class="o">.</span><span class="n">Jet</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ProblemGenerator</span><span class="p">,</span><span class="n">ProblemArgs</span><span class="p">,</span><span class="n">Nthreads</span><span class="p">,</span><span class="n">PrintConsole</span><span class="p">)</span>

<span class="c1">### Access the solved phases/ocps</span>
<span class="n">ocps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Phase</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">returnTraj</span><span class="p">()</span>
</pre></div>
</div>
<p>For both methods, if console printing is enabled, Jet will dynamically print out its progress, and alert of the convergence rate of each problem and the estimated remaining run-time.</p>
<a class="reference internal image-reference" href="../_images/JetGif4.gif"><img alt="../_images/JetGif4.gif" src="../_images/JetGif4.gif" style="width: 100%;" /></a>
<p>We should make a few notes about the performance. First, best performance is usually seen by using a number of threads equal to or slightly greater than the number
of physical cores on your machine, anymore can lead to over-subscription of the CPU.
Second, you should limit the maximum number of problems solved in a single Jet run to somewhere between 2000 and 10000.
Solving too many problems at a time with Jet puts serious strain on the process heap and performance can degrade considerably. The exact number when this occurs is dependent on
the size of each optimization problem, but you can generally identify when it happens by observing lower than expected CPU utilization during a run.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="AutoMeshGuide.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Adaptive Mesh Refinement Tutorial</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="OptimalControlProblem.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Optimal Control Problem Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, UA ASRL
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">PSIOPT</a><ul>
<li><a class="reference internal" href="#psiopt-usage">PSIOPT Usage</a><ul>
<li><a class="reference internal" href="#threading">Threading</a></li>
<li><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jet">Jet</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>