<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-5.3.0, furo 2022.09.29"/>
        <title>Integrators - ASSET 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ASSET 0.0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">ASSET 0.0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="Install.html">Installing ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="VectorFunctionGuide.html">Vector Function Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="ODEGuide.html">ODE Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="IntegratorGuide.html">Integrator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="PhaseGuide.html">Optimal Control Phase Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlProblem.html">Optimal Control Problem Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="PSIOPT.html">PSIOPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlUtilites.html">Optimal Control Utilities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/Delta3.html">Delta 3 Multi-phase GTO Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/ReentryExample.html">Space Shuttle Reentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/CartPole.html">Cart-Pole Swing Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/halo.html">Orbit Family Continuation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelo.html">Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelolink.html">Multi-Phase Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/MultiTarg.html">Multi-Spacecraft Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python/python.html">Python Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../python/asset.html">ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/optimalcontrol.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/vectorfunctions.html">Vector Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/Astro.html">ASSET Astro Library</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="integrators">
<h1>Integrators<a class="headerlink" href="#integrators" title="Permalink to this heading">#</a></h1>
<p>Almost all use cases for ASSET will involve numerical integration of some type.
To that end, the integration module includes support for a range of common integrator methods.
In this module we will describe some typical examples for basic integration use, as well as more advanced scenarios involving stopping criteria and integration control laws.</p>
<div class="section" id="basic-use">
<h2>Basic Use<a class="headerlink" href="#basic-use" title="Permalink to this heading">#</a></h2>
<p>If you haven’t covered the <span class="xref std std-ref">Python: Vector Functions</span> tutorial, we would recommend you do so now before proceeding.
Every ASSET <code class="code docutils literal notranslate"><span class="pre">Integrator</span></code> object requires an <code class="code docutils literal notranslate"><span class="pre">ODE</span></code> instance to be constructed.
We will start with the same Two-Body Solar Sail ODE that we used in <span class="xref std std-ref">Python: Vector Functions</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="n">vf</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">VectorFunctions</span>
<span class="n">oc</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span>

<span class="n">Args</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">Arguments</span>
<span class="n">Tmodes</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">TranscriptionModes</span>


<span class="k">def</span> <span class="nf">SolarSail_Acc</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="n">ndr2</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">squared</span><span class="p">()</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">ndr2</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">inverse_four_norm</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">acc</span>


<span class="k">def</span> <span class="nf">Full_TwoBody_SolarSail_Model</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head_3</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">segment_3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tail_3</span><span class="p">()</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span> <span class="o">+</span> <span class="n">SolarSail_Acc</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vf</span><span class="o">.</span><span class="n">Stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">acc</span><span class="p">])</span>


<span class="n">Two_Body_SolarSail_ODE</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">ode_x_u</span><span class="o">.</span><span class="n">ode</span><span class="p">(</span><span class="n">Full_TwoBody_SolarSail_Model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">phase</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">Two_Body_SolarSail_ODE</span><span class="p">,</span> <span class="n">Tmodes</span><span class="o">.</span><span class="n">LGL3</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we have defined our ODE, the next step is to create the Integrator object that will perform the integration.
After defining our ODE we can create the integrator by calling the <code class="code docutils literal notranslate"><span class="pre">integrator</span></code> method attached to each ASSET ODE.
In the most basic case the code::<cite>integrator</cite> method takes just the desired step size for the integration.
If an adaptive integration step is preferred (as it often is more applications where speed is desirable), each <code class="code docutils literal notranslate"><span class="pre">integrator</span></code> object has an attached <code class="code docutils literal notranslate"><span class="pre">adaptive</span></code> method.
By default the flag is set to <code class="code docutils literal notranslate"><span class="pre">False</span></code>, but can be set to true as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">integrator</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">Adaptive</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Now with our integrator setup we can integrate the ODE attached to the integrator through its <code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code> method.
As always we will first need an initial state to start our integration with.
Here we will use the same initial problem formulation that can be found in the <span class="xref std std-ref">Phase Tutorial</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">R0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">V0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RF</span> <span class="o">=</span> <span class="mf">1.1</span>

<span class="n">IState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">))</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">R0</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">Adaptive</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">FinalTime</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">NumStates</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">IG</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span><span class="n">FinalTime</span> <span class="p">,</span> <span class="n">NumStates</span><span class="p">)</span>
</pre></div>
</div>
<p>After initializing our <code class="code docutils literal notranslate"><span class="pre">IState</span></code> telling our integrator where to start, we can call the <code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code> method, which takes the desired initial state, as well as the final time to stop the integration.
The last argument in the function call is the desired number of states to return in the output.
With that, <code class="code docutils literal notranslate"><span class="pre">IG</span></code> will be populated with the result of the integration.
But one limitation of the above code is that it is assumed that the control variables are constant throughout the integration, which may not be desirable for highly chaotic dynamics where a good initial guess may be required.
In support of this ASSET features integrator constructors for applying a control law directly to an integration.</p>
</div>
<div class="section" id="control-laws">
<h2>Control Laws<a class="headerlink" href="#control-laws" title="Permalink to this heading">#</a></h2>
<p>Continuing with the above example, a few simple changes allows one to add a control law to an <code class="code docutils literal notranslate"><span class="pre">integrator</span></code> object.
If, for example, we wished to generate an initial guess for a solar sailing transfer trajectory, a control law that orients the control vector of the sail in the prograde direction may be useful.
This control law will orient the sail throughout the integration to direct the normal vector of the sail in the prograde direction, in this case providing a better initial guess for the optimal control problem, as opposed to flying with a fixed sail orientation.
The constructor for the integrator with a control law is very similar to the typical integrator formation, however now the function and relevant state variables must be passed as arguments to the constructor.
<code class="code docutils literal notranslate"><span class="pre">ProgradeFunc</span></code> is passed to the constructor, along with the integers 0-5, which tells the integrator to use the first 6 state variables from each state during integration.
Note that the number of output variables from the control law <strong>must</strong> match the number of controls defined in the ODE, and the order of return variables must be the same as the order of those in the state.
In this case we defined that our ODE, <code class="code docutils literal notranslate"><span class="pre">Two_Body_SolarSail_ODE</span></code>, has 3 control variables and our integrator control law returns 3 as well.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ProgradeFunc</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">rhat</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head3</span><span class="p">()</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="n">vhat</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tail3</span><span class="p">()</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rhat</span> <span class="o">+</span> <span class="n">vhat</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>


<span class="n">integ</span> <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ProgradeFunc</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">IG</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<p>Performing the integration after defining our control law is the same as previously shown, by calling <code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code> on the <code class="code docutils literal notranslate"><span class="pre">integrator</span></code> object and passing the initial state, final time, and the number of states to return.</p>
</div>
<div class="section" id="state-transition-matrices">
<h2>State Transition Matrices<a class="headerlink" href="#state-transition-matrices" title="Permalink to this heading">#</a></h2>
<p>As well as having the capbility to integrate states, the ASSET integrators are also capable of integrating state transition matrices (STMs).
Integrating STMs can be done in one at a time or in parallel.
Integrating an STM requires no additional parameters to be done, as long as the relevant ODE has been defined.
For completeness’ sake we will continue to use the previously defined ODE <code class="code docutils literal notranslate"><span class="pre">Full_TwoBody_SolarSail_Model</span></code> and the same integrator instance <code class="code docutils literal notranslate"><span class="pre">integ</span></code>.
The STM integration will return the STM of the full ODE, including the time, final time, and control variables as well as the final integrated state in the form of a tuple.
This results in an integrated STM that is of the size of the ODE by ODE + 1.
If the integrator that is being used to generate the STM has been defined with a control law, that control law will also be used during the integration.
Keep in mind, however, that the derivatives with respect to the controls will be 0, as the initial controls will be modified throughout the course of the integration.
If the integrator does not have a control law, then the controls will be propagated as constants throughout the integration.
The <code class="code docutils literal notranslate"><span class="pre">integrate_stm</span></code> function is used practically the same way as the standard integration method, as shown below.
Additionally, we can also integrate many STMs in parallel, to decrease the amount of time required to evaluate large numbers of states.
The parallel evaluation simply takes a list of initial states and times, and the number of cores that should be used for the integration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#single STM and state</span>
<span class="c1">#The state and STM are returned as a tuple, so we can unpack both of them at the same time</span>
<span class="n">finalState</span><span class="p">,</span> <span class="n">stmSingle</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_stm</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1">#We will now do many STMs in parallel</span>
<span class="n">stateList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timeList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#For this example we will initialize our input vectors with the same states and times, but this is not a requirement</span>
<span class="c1">#All of the initial states be different and have their own final times to integrate to</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">stateList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IState</span><span class="p">)</span>
    <span class="n">timeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1">#The only difference in arguments is that integrate_stm_parallel takes a list of states and times,</span>
<span class="c1">#as well as the number of cores to use</span>
<span class="c1">#The method also returns the final list of states and STMs</span>
<span class="n">fileStateVec</span><span class="p">,</span> <span class="n">stmVec</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_stm_parallel</span><span class="p">(</span><span class="n">stateList</span><span class="p">,</span> <span class="n">timeList</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parallel-integration">
<h2>Parallel Integration<a class="headerlink" href="#parallel-integration" title="Permalink to this heading">#</a></h2>
<p>Similar to the parallel integration of the STMS, <code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code> features a similar method, <code class="code docutils literal notranslate"><span class="pre">integrate_dense_parallel</span></code>.
Using the list of states and times produced in our parallel STM example we can write:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#number of threads to use with the parallel integration</span>
<span class="n">numthreads</span> <span class="o">=</span> <span class="mi">8</span>
<span class="c1">#Returns a list of lists of the vector outputs of the integration, one for each initial state and time.</span>
<span class="n">IG_Parallel</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense_parallel</span><span class="p">(</span><span class="n">stateList</span><span class="p">,</span> <span class="n">timeList</span><span class="p">,</span> <span class="n">numthreads</span><span class="p">)</span>
</pre></div>
</div>
<p>Likewise with the STM parallel integration, the return value is a list of the vector results for each initial state and time.
As a word of caution, the input size for the initial states and times <strong>must</strong> be the same size.</p>
<div class="section" id="full-source-listing">
<h3>Full Source Listing<a class="headerlink" href="#full-source-listing" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset</span> <span class="k">as</span> <span class="nn">ast</span>

<span class="n">vf</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">VectorFunctions</span>
<span class="n">oc</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span>

<span class="n">Args</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">Arguments</span>
<span class="n">Tmodes</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">TranscriptionModes</span>


<span class="k">def</span> <span class="nf">SolarSail_Acc</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
    <span class="n">ndr2</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">squared</span><span class="p">()</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">ndr2</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">inverse_four_norm</span><span class="p">()</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">acc</span>


<span class="k">def</span> <span class="nf">Full_TwoBody_SolarSail_Model</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head_3</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">segment_3</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tail_3</span><span class="p">()</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span> <span class="o">+</span> <span class="n">SolarSail_Acc</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vf</span><span class="o">.</span><span class="n">Stack</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="n">acc</span><span class="p">])</span>


<span class="n">Two_Body_SolarSail_ODE</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">ode_x_u</span><span class="o">.</span><span class="n">ode</span><span class="p">(</span><span class="n">Full_TwoBody_SolarSail_Model</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">phase</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">phase</span><span class="p">(</span><span class="n">Two_Body_SolarSail_ODE</span><span class="p">,</span> <span class="n">Tmodes</span><span class="o">.</span><span class="n">LGL3</span><span class="p">)</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">Adaptive</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">R0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">V0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RF</span> <span class="o">=</span> <span class="mf">1.1</span>

<span class="n">IState</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">))</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">R0</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">V0</span>
<span class="n">IState</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">integrator</span> <span class="o">=</span> <span class="n">Two_Body_SolarSail_ODE</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">integrator</span><span class="o">.</span><span class="n">Adaptive</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">FinalTime</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">NumStates</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">IG</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span><span class="n">FinalTime</span> <span class="p">,</span> <span class="n">NumStates</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">ProgradeFunc</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">rhat</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">head3</span><span class="p">()</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="n">vhat</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">tail3</span><span class="p">()</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rhat</span> <span class="o">+</span> <span class="n">vhat</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>


<span class="n">integ</span> <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">ProgradeFunc</span><span class="p">(),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">IG</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="c1">#single STM and state</span>
<span class="c1">#The state and STM are returned as a tuple, so we can unpack both of them at the same time</span>
<span class="n">finalState</span><span class="p">,</span> <span class="n">stmSingle</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_stm</span><span class="p">(</span><span class="n">IState</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1">#We will now do many STMs in parallel</span>
<span class="n">stateList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timeList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#For this example we will initialize our input vectors with the same states and times, but this is not a requirement</span>
<span class="c1">#All of the initial states be different and have their own final times to integrate to</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
    <span class="n">stateList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IState</span><span class="p">)</span>
    <span class="n">timeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="c1">#number of threads to use with the parallel integration</span>
<span class="n">numthreads</span> <span class="o">=</span> <span class="mi">8</span>
<span class="c1">#The only difference in arguments is that integrate_stm_parallel takes a list of states and times,</span>
<span class="c1">#as well as the number of cores to use</span>
<span class="c1">#The method also returns the final list of states and STMs</span>
<span class="n">fileStateVec</span><span class="p">,</span> <span class="n">stmVec</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_stm_parallel</span><span class="p">(</span><span class="n">stateList</span><span class="p">,</span> <span class="n">timeList</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="c1">#Integrating a list of initial states and times with integrate_dense_parallel</span>
<span class="c1">#Returns a list of lists of the vector outputs of the integration, one for each initial state and time.</span>
<span class="n">IG_Parallel</span> <span class="o">=</span> <span class="n">integ</span><span class="o">.</span><span class="n">integrate_dense_parallel</span><span class="p">(</span><span class="n">stateList</span><span class="p">,</span> <span class="n">timeList</span><span class="p">,</span> <span class="n">numthreads</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, UA ASRL
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Integrators</a><ul>
<li><a class="reference internal" href="#basic-use">Basic Use</a></li>
<li><a class="reference internal" href="#control-laws">Control Laws</a></li>
<li><a class="reference internal" href="#state-transition-matrices">State Transition Matrices</a></li>
<li><a class="reference internal" href="#parallel-integration">Parallel Integration</a><ul>
<li><a class="reference internal" href="#full-source-listing">Full Source Listing</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    </body>
</html>