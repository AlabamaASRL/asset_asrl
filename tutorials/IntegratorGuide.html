<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Optimal Control Phase Tutorial" href="PhaseGuide.html" /><link rel="prev" title="ODE Tutorial" href="ODEGuide.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.05.20 -->
        <title>Integrator Tutorial - ASSET 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: red;
  --color-brand-content: #CC3333;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ASSET 0.2.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/ASSETLOGO.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ASSET 0.2.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Install.html">Installing ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="VectorFunctionGuide.html">Vector Function Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="ODEGuide.html">ODE Tutorial</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Integrator Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="PhaseGuide.html">Optimal Control Phase Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlProblem.html">Optimal Control Problem Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="PSIOPT.html">PSIOPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="AutoMeshGuide.html">Adaptive Mesh Refinement Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="OptimalControlUtilites.html">Optimal Control Utilities</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/Delta3.html">Delta 3 Multi-phase GTO Transfer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/ReentryExample.html">Space Shuttle Reentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/CartPole.html">Cart-Pole Swing Up</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/HyperSensitive.html">Hyper-Sensitive Optimal Control Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/halo.html">Orbit Family Continuation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelo.html">Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/zermelolink.html">Multi-Phase Zermelo’s Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/MultiTarg.html">Multi-Spacecraft Optimization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python/python.html">Python Library Documentation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Python Library Documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../python/asset.html">ASSET</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/optimalcontrol.html">Optimal Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/vectorfunctions.html">Vector Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/Astro.html">ASSET Astro Library</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="integrator-tutorial">
<span id="integrator-guide"></span><h1>Integrator Tutorial<a class="headerlink" href="#integrator-tutorial" title="Permalink to this heading">#</a></h1>
<p>In this section, we will describe usage of ASSET’s integrator object. To
start, we will define an ODE which we want to integrate using what we have learned from the
previous two sections on <a class="reference internal" href="VectorFunctionGuide.html#vectorfunction-guide"><span class="std std-ref">vector functions</span></a> and <a class="reference internal" href="ODEGuide.html#ode-guide"><span class="std std-ref">ODEs</span></a>.
As an example, we use a ballistic two body
model whose state variables are the position and velocity relative to a central body
with gravitational parameter, <span class="math notranslate nohighlight">\(\mu\)</span>. This ODE may be defined as shown below.
For this example, we will be working in canonical units where <span class="math notranslate nohighlight">\(\mu = 1\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asset_asrl</span> <span class="k">as</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="n">vf</span>        <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">VectorFunctions</span>
<span class="n">oc</span>        <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">OptimalControl</span>
<span class="n">Args</span>      <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">Arguments</span>


<span class="k">class</span> <span class="nc">TwoBody</span><span class="p">(</span><span class="n">oc</span><span class="o">.</span><span class="n">ODEBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mu</span><span class="p">):</span>

        <span class="n">XVars</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">XtU</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">ODEArguments</span><span class="p">(</span><span class="n">XVars</span><span class="p">)</span>

        <span class="n">R</span><span class="p">,</span><span class="n">V</span>  <span class="o">=</span> <span class="n">XtU</span><span class="o">.</span><span class="n">XVec</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>

        <span class="n">G</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span>

        <span class="n">Rdot</span> <span class="o">=</span> <span class="n">V</span>
        <span class="n">Vdot</span> <span class="o">=</span> <span class="n">G</span>

        <span class="n">ode</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">Rdot</span><span class="p">,</span><span class="n">Vdot</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ode</span><span class="p">,</span><span class="n">XVars</span><span class="p">)</span>
</pre></div>
</div>
<section id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading">#</a></h2>
<p>To start, we can create an integrator for our ODE by using the <code class="code docutils literal notranslate"><span class="pre">.integrator</span></code> method of the ODE.
At initialization we can specify the integration scheme as a string as well as the
default step size to be used. At the moment we provide the adaptive Dormand Prince
integration schemes of order 8(7) and 5(4). These are specified by the strings <code class="code docutils literal notranslate"><span class="pre">&quot;DOPRI87&quot;</span></code> or
<code class="code docutils literal notranslate"><span class="pre">&quot;DOPRI54&quot;</span></code>. If no method is specified, the integration will default to <code class="code docutils literal notranslate"><span class="pre">&quot;DOPRI87&quot;</span></code>. The second
argument, <code class="code docutils literal notranslate"><span class="pre">DefStepSize</span></code> is the first trial step size in the adaptive integration algorithm, which will then
adjust the step size up or down to meet specified error tolerances. By default, we set the
integrator’s minimum and maximum allowable step sizes to be 10000 times smaller and larger than
the default step size. However, you can override this by manually setting all step sizes using the
<code class="code docutils literal notranslate"><span class="pre">.setStepSizes</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TBode</span> <span class="o">=</span> <span class="n">TwoBody</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">DefStepSize</span> <span class="o">=</span> <span class="mf">.1</span>

<span class="c1">#Initialization</span>
<span class="n">TBInteg</span> <span class="o">=</span> <span class="n">TBode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="s2">&quot;DOPRI87&quot;</span><span class="p">,</span><span class="n">DefStepSize</span><span class="p">)</span>
<span class="n">TBInteg</span> <span class="o">=</span> <span class="n">TBode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="s2">&quot;DOPRI54&quot;</span><span class="p">,</span><span class="n">DefStepSize</span><span class="p">)</span>
<span class="n">TBInteg</span> <span class="o">=</span> <span class="n">TBode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="n">DefStepSize</span><span class="p">)</span>  <span class="c1"># Default is DOPRI87</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default StepSize    = DefStepSize = &quot;</span>      <span class="p">,</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">DefStepSize</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default MinStepSize = DefStepSize/10000 = &quot;</span><span class="p">,</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">MinStepSize</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default MaxStepSize = DefStepSize*10000 = &quot;</span><span class="p">,</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">MaxStepSize</span><span class="p">)</span>

<span class="n">MinStepSize</span> <span class="o">=</span> <span class="mf">1e-6</span>
<span class="n">MaxStepSize</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1">## Set def,min, and max step sizes manually</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">setStepSizes</span><span class="p">(</span><span class="n">DefStepSize</span><span class="p">,</span><span class="n">MinStepSize</span><span class="p">,</span><span class="n">MaxStepSize</span><span class="p">)</span>
</pre></div>
</div>
<p>Both integration schemes use the standard absolute and relative tolerance
metrics to assess the accuracy of steps and update the step size adaptively.
By default we set the absolute tolerance on all state variables equal to 1.0e-12
and the relative tolerance to 0.0. This usually works well for well scaled dynamics
equations such as our two-body model with <span class="math notranslate nohighlight">\(\mu = 1\)</span>. However, you can set them manually
yourself using the <code class="code docutils literal notranslate"><span class="pre">.setAbs/RelTol</span></code> methods as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TBode</span> <span class="o">=</span> <span class="n">TwoBody</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">DefStepSize</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">TBInteg</span> <span class="o">=</span> <span class="n">TBode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="n">DefStepSize</span><span class="p">)</span>  <span class="c1"># Default is DOPRI87</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default AbsTols = [1.0-12...] = &quot;</span><span class="p">,</span><span class="n">TBInteg</span><span class="o">.</span><span class="n">getAbsTols</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Default RelTols = [0.0,  ...] = &quot;</span><span class="p">,</span><span class="n">TBInteg</span><span class="o">.</span><span class="n">getRelTols</span><span class="p">())</span>

<span class="n">AbsTol</span>      <span class="o">=</span> <span class="mf">1.0e-13</span>
<span class="n">RelTol</span>      <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Set tolerances uniformly for all state variables</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">setAbsTol</span><span class="p">(</span><span class="n">AbsTol</span><span class="p">)</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">setRelTol</span><span class="p">(</span><span class="n">RelTol</span><span class="p">)</span>

<span class="n">AbsTols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="mf">1.0e-13</span>
<span class="n">RelTols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">1.0e-9</span>
<span class="c1"># Set tolerances individually for each state variables</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">setAbsTols</span><span class="p">(</span><span class="n">AbsTols</span><span class="p">)</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">setRelTols</span><span class="p">(</span><span class="n">RelTols</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="integration">
<h2>Integration<a class="headerlink" href="#integration" title="Permalink to this heading">#</a></h2>
<p>Now that we have covered initializing integrators, let’s examine how we actually
use them. By far the most used methods are <code class="code docutils literal notranslate"><span class="pre">.integrate</span></code> and <code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code>. Both methods
take as the first input a full-state vector containing the initial state, time, controls, and
parameters as well as the final time that we wish to integrate these initial inputs to.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">.integrate</span></code> method  integrates this initial full-ODE input vector to final time <code class="code docutils literal notranslate"><span class="pre">tf</span></code> and returns only the full-ODE input vector at the final time.
<code class="code docutils literal notranslate"><span class="pre">integrate_dense</span></code> takes the same inputs but returns all intermediate full-states
calculated by the integrator as single python list. We can also call <code class="code docutils literal notranslate"><span class="pre">.integrate_dense</span></code>
with an additional argument specifying that we would like to return <code class="code docutils literal notranslate"><span class="pre">N</span></code> evenly spaced steps
between <code class="code docutils literal notranslate"><span class="pre">t0</span></code> and <code class="code docutils literal notranslate"><span class="pre">tf</span></code> rather than the exact steps taken by the solver. These <code class="code docutils literal notranslate"><span class="pre">N</span></code> states and controls
will be calculated from the exact steps taken by the integrator using a fifth order interpolation method.
For the <code class="code docutils literal notranslate"><span class="pre">&quot;DOPRI54&quot;</span></code> method, interpolated states have effectively
the exact same error as the true steps taken by the integrator. However, for the <code class="code docutils literal notranslate"><span class="pre">&quot;DOPRI87&quot;</span></code> method, interpolated states
will have larger local error owing the difference in order between the integration and interpolation. In practice,
the maximum local error at any point along the trajectory is typically 2 orders of magnitude larger than the integration tolerances.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TBode</span> <span class="o">=</span> <span class="n">TwoBody</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">DefStepSize</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">TBInteg</span> <span class="o">=</span> <span class="n">TBode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="n">DefStepSize</span><span class="p">)</span>


<span class="n">r</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">v</span>  <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">X0t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">))</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span>

<span class="c1"># Just the final full-state</span>
<span class="n">Xftf</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>


<span class="n">TrajExact</span>  <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>

<span class="n">N</span>  <span class="o">=</span> <span class="mi">100</span>
<span class="n">TrajInterpN</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/IntegratorFig1.svg"><img alt="../_images/IntegratorFig1.svg" src="../_images/IntegratorFig1.svg" width="90%" /></a>
</section>
<section id="event-detection">
<h2>Event Detection<a class="headerlink" href="#event-detection" title="Permalink to this heading">#</a></h2>
<p>We can also pass a list of events to be detected during the integration. A single
event is defined as a tuple consisting of: An ASSET ScalarFunction whose zeros
determine the locations of the event, a direction indicating whether we want to track ascending, descending or all zeros, and a stop code
signifying whether integration should stop after encountering a zero. The ScalarFunction should take the same arguments as the underlying ODE.
The <code class="code docutils literal notranslate"><span class="pre">direction</span></code> flag should be set to <code class="code docutils literal notranslate"><span class="pre">0</span></code> to capture all zeros, <code class="code docutils literal notranslate"><span class="pre">-1</span></code> to capture only zeros where the function value is decreasing, or <code class="code docutils literal notranslate"><span class="pre">1</span></code> to capture
zeros where it is increasing. The <code class="code docutils literal notranslate"><span class="pre">stopcode</span></code> should be set to <code class="code docutils literal notranslate"><span class="pre">0</span></code> or <code class="code docutils literal notranslate"><span class="pre">False</span></code> if you do not want an event to stop integration. To stop after 1 occurrence,
<code class="code docutils literal notranslate"><span class="pre">stopcode</span></code> can be set to <code class="code docutils literal notranslate"><span class="pre">1</span></code> or <code class="code docutils literal notranslate"><span class="pre">True</span></code>. The <code class="code docutils literal notranslate"><span class="pre">stopcode</span></code> can also be set to any positive integer, in which case it specifies the number of zeros to be encountered
before stopping. When events are appended to an integration call, in addition to the normal return value, a list of lists of the exact full-states where each event occurred is
also returned. As an example, the code below will calculate the apoapses and periapses of an orbit, and stop after both have been found. Exact roots
of events are found using a Newton-Raphson method applied to the fifth order spline continuous representation of the trajectory. The root tolerance
and maximum Newton iterations may be specified by modifying the <code class="code docutils literal notranslate"><span class="pre">EventTol</span></code> and <code class="code docutils literal notranslate"><span class="pre">MaxEventIters</span></code> fields of the integrator. These default, to 10 and 1e-6 respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">v</span>  <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">N</span>  <span class="o">=</span> <span class="mi">1000</span>


<span class="n">X0t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">))</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span>

<span class="k">def</span> <span class="nf">ApseFunc</span><span class="p">():</span>
    <span class="n">R</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

<span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">stopcode</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">ApoApseEvent</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ApseFunc</span><span class="p">(),</span><span class="n">direction</span><span class="p">,</span><span class="n">stopcode</span><span class="p">)</span>


<span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">stopcode</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">PeriApseEvent</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ApseFunc</span><span class="p">(),</span><span class="n">direction</span><span class="p">,</span><span class="n">stopcode</span><span class="p">)</span>


<span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">stopcode</span>  <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Stop after finding 2 apses</span>
<span class="n">AllApseEvent</span>  <span class="o">=</span> <span class="p">(</span><span class="n">ApseFunc</span><span class="p">(),</span><span class="n">direction</span><span class="p">,</span><span class="n">stopcode</span><span class="p">)</span>


<span class="n">Events</span> <span class="o">=</span> <span class="p">[</span><span class="n">ApoApseEvent</span><span class="p">,</span><span class="n">PeriApseEvent</span><span class="p">,</span><span class="n">AllApseEvent</span><span class="p">]</span>


<span class="n">TBInteg</span><span class="o">.</span><span class="n">EventTol</span> <span class="o">=</span><span class="mf">1.0e-10</span>
<span class="n">TBInteg</span><span class="o">.</span><span class="n">MaxEventIters</span> <span class="o">=</span><span class="mi">12</span>

<span class="c1">## Just append event list to any normal call</span>
<span class="n">Xftf</span><span class="p">,</span> <span class="n">EventLocs</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">Events</span><span class="p">)</span>

<span class="n">Traj</span><span class="p">,</span> <span class="n">EventLocs</span>  <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">Events</span><span class="p">)</span>

<span class="n">Traj</span><span class="p">,</span> <span class="n">EventLocs</span>  <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">Events</span><span class="p">)</span>

<span class="c1">#EventLocs[i] will be empty if the event was not detected</span>

<span class="n">ApoApseEventLocs</span>  <span class="o">=</span> <span class="n">EventLocs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ApoApse</span> <span class="o">=</span><span class="n">ApoApseEventLocs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">PeriApseEventLocs</span> <span class="o">=</span> <span class="n">EventLocs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">PeriApse</span> <span class="o">=</span><span class="n">PeriApseEventLocs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Or</span>
<span class="n">AllApseEventLocs</span>  <span class="o">=</span> <span class="n">EventLocs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ApoApse</span>  <span class="o">=</span> <span class="n">AllApseEventLocs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">PeriApse</span> <span class="o">=</span> <span class="n">AllApseEventLocs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/IntegratorFig2.svg"><img alt="../_images/IntegratorFig2.svg" src="../_images/IntegratorFig2.svg" width="90%" /></a>
</section>
<section id="derivatives">
<h2>Derivatives<a class="headerlink" href="#derivatives" title="Permalink to this heading">#</a></h2>
<p>In ASSET, integrators themselves are VectorFunctions and have analytic first and second
derivatives. The input arguments for the integrator when used as a VectorFunction consist of
the full-ODE input to be integrated and the final time <code class="code docutils literal notranslate"><span class="pre">tf,</span></code> and the output is the full-ODE at time <code class="code docutils literal notranslate"><span class="pre">tf</span></code>.
For example, calling compute as shown below is equivalent to the normal integrate call. This also means
that we can calculate the <code class="code docutils literal notranslate"><span class="pre">jacobian</span></code> and <code class="code docutils literal notranslate"><span class="pre">adjointhessian</span></code> as well.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">v</span>  <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">20.0</span>


<span class="n">X0t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">))</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
<span class="n">X0t0</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span>

<span class="n">X0t0tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">))</span>
<span class="n">X0t0tf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span><span class="n">X0t0</span>
<span class="n">X0t0tf</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">=</span><span class="n">tf</span>



<span class="n">Xftf</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>

<span class="c1"># Same as above</span>
<span class="n">Xftf</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">X0t0tf</span><span class="p">)</span>

<span class="n">Jac</span> <span class="o">=</span>  <span class="n">TBInteg</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">X0t0tf</span><span class="p">)</span>
<span class="n">Hess</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">adjointhessian</span><span class="p">(</span><span class="n">X0t0tf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">7</span><span class="p">)))</span>
</pre></div>
</div>
<p>We should note that the jacobian of an integrator is the same as the state transition matrix (STM).
Since calculation of an ODE’s state transition matrix (STM), is critical to assessing
the stability of periodic orbits and many other applications, we also provide methods to calculate the STM through the integrator
interface using the <code class="code docutils literal notranslate"><span class="pre">.integrate_stm</span></code> methods, which can be used as shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Xftf</span><span class="p">,</span><span class="n">Jac</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_stm</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>

<span class="c1">## With Events</span>

<span class="n">Xftf</span><span class="p">,</span><span class="n">Jac</span><span class="p">,</span> <span class="n">EventLocs</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_stm</span><span class="p">(</span><span class="n">X0t0</span><span class="p">,</span><span class="n">tf</span><span class="p">,</span><span class="n">Events</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parrallel-integration">
<h2>Parrallel Integration<a class="headerlink" href="#parrallel-integration" title="Permalink to this heading">#</a></h2>
<p>Finally, for all previously discussed <code class="code docutils literal notranslate"><span class="pre">.integrate</span></code> methods, we have corresponding multi-threaded <code class="code docutils literal notranslate"><span class="pre">_parallel</span></code>
versions which will integrate lists of initial conditions and final times in parallel. In each case, rather
than passing a single initial state and final time, we pass lists of each. The outputs to the call will then be a list
of length <code class="code docutils literal notranslate"><span class="pre">n</span></code> containing the outputs of the regular non-parallel method for the ith input state and final time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">nthreads</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">X0t0s</span> <span class="o">=</span><span class="p">[</span><span class="n">X0t0</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>
<span class="n">tfs</span>   <span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="p">]</span><span class="o">*</span><span class="n">n</span>


<span class="n">Xftfs</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_parallel</span><span class="p">(</span><span class="n">X0t0s</span><span class="p">,</span><span class="n">tfs</span><span class="p">,</span><span class="n">nthreads</span><span class="p">)</span>

<span class="n">Xftf_Jacs</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_stm_parallel</span><span class="p">(</span><span class="n">X0t0s</span><span class="p">,</span><span class="n">tfs</span><span class="p">,</span><span class="n">nthreads</span><span class="p">)</span>

<span class="n">Xftf_Jac_EventLocs</span> <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_stm_parallel</span><span class="p">(</span><span class="n">X0t0s</span><span class="p">,</span><span class="n">tfs</span><span class="p">,</span><span class="n">Events</span><span class="p">,</span><span class="n">nthreads</span><span class="p">)</span>

<span class="n">Trajs</span>  <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense_parallel</span><span class="p">(</span><span class="n">X0t0s</span><span class="p">,</span><span class="n">tfs</span><span class="p">,</span><span class="n">nthreads</span><span class="p">)</span>

<span class="n">Traj_EventLocs</span>  <span class="o">=</span> <span class="n">TBInteg</span><span class="o">.</span><span class="n">integrate_dense_parallel</span><span class="p">(</span><span class="n">X0t0s</span><span class="p">,</span><span class="n">tfs</span><span class="p">,</span><span class="n">Events</span><span class="p">,</span><span class="n">nthreads</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>

    <span class="n">Xftf</span> <span class="o">=</span> <span class="n">Xftfs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">Xftf</span><span class="p">,</span><span class="n">Jac</span> <span class="o">=</span> <span class="n">Xftf_Jacs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">Xftf</span><span class="p">,</span><span class="n">Jac</span><span class="p">,</span><span class="n">EventLocs</span> <span class="o">=</span> <span class="n">Xftf_Jac_EventLocs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">Traj</span> <span class="o">=</span> <span class="n">Trajs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">Traj</span><span class="p">,</span><span class="n">EventLocs</span> <span class="o">=</span> <span class="n">Traj_EventLocs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="local-control-laws">
<h2>Local Control Laws<a class="headerlink" href="#local-control-laws" title="Permalink to this heading">#</a></h2>
<p>In the previous examples we only examined how to integrate ODEs with no control
or constant controls, but oftentimes we need to compute controls as a function
of the local state or time. We can do this in ASSET by initializing our integrator with
a control law. As an example, let’s reuse our <code class="code docutils literal notranslate"><span class="pre">TwoBodyLTODE</span></code> ode from the <a class="reference internal" href="ODEGuide.html#ode-guide"><span class="std std-ref">ODE Tutorial</span></a> section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TwoBodyLTODE</span><span class="p">(</span><span class="n">oc</span><span class="o">.</span><span class="n">ODEBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">MaxLTAcc</span><span class="p">):</span>
        <span class="n">XVars</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">UVars</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">XtU</span> <span class="o">=</span> <span class="n">oc</span><span class="o">.</span><span class="n">ODEArguments</span><span class="p">(</span><span class="n">XVars</span><span class="p">,</span><span class="n">UVars</span><span class="p">)</span>

        <span class="n">R</span><span class="p">,</span><span class="n">V</span>  <span class="o">=</span> <span class="n">XtU</span><span class="o">.</span><span class="n">XVec</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">XtU</span><span class="o">.</span><span class="n">UVec</span><span class="p">()</span>

        <span class="n">G</span> <span class="o">=</span> <span class="o">-</span><span class="n">mu</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">normalized_power3</span><span class="p">()</span>
        <span class="n">Acc</span> <span class="o">=</span> <span class="n">G</span> <span class="o">+</span> <span class="n">U</span><span class="o">*</span><span class="n">MaxLTAcc</span>

        <span class="n">Rdot</span> <span class="o">=</span> <span class="n">V</span>
        <span class="n">Vdot</span> <span class="o">=</span> <span class="n">Acc</span>

        <span class="n">ode</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">Rdot</span><span class="p">,</span><span class="n">Vdot</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ode</span><span class="p">,</span><span class="n">XVars</span><span class="p">,</span><span class="n">UVars</span><span class="p">)</span>
</pre></div>
</div>
<p>We will add a control to the integrator specifying that throttle should be 80%
of the maximum and aligned with the spacecraft’s instantaneous velocity vector. We do this by first writing
an ASSET VectorFunction , that is assumed to take only the velocity as arguments and outputs
the desired control vector. We can then pass this to the integrator constructor along with a list
specifying the indices full-ODE input variables we want to forward to our control law. In this case it
is <code class="code docutils literal notranslate"><span class="pre">[3,4,5]</span></code> which are the velocity variables as we have defined in our ODE.
This control law will now be applied to all of our integrations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ULaw</span><span class="p">(</span><span class="n">throttle</span><span class="p">):</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Args</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">V</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span><span class="o">*</span><span class="n">throttle</span>

<span class="n">ode</span> <span class="o">=</span> <span class="n">TwoBodyLTODE</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">integNoUlaw</span> <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="s2">&quot;DOPRI87&quot;</span><span class="p">,</span><span class="mf">.1</span><span class="p">)</span>
<span class="n">integULaw</span>   <span class="o">=</span> <span class="n">ode</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="s2">&quot;DOPRI87&quot;</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="n">ULaw</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>

<span class="n">r</span>  <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">v</span>  <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">20.0</span>

<span class="n">X0t0U0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">))</span>
<span class="n">X0t0U0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
<span class="n">X0t0U0</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>
<span class="n">X0t0U0</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">=</span><span class="n">t0</span>

<span class="n">TrajNoULaw</span> <span class="o">=</span> <span class="n">integNoUlaw</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0U0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>
<span class="n">TrajULaw</span>   <span class="o">=</span> <span class="n">integULaw</span><span class="o">.</span><span class="n">integrate_dense</span><span class="p">(</span><span class="n">X0t0U0</span><span class="p">,</span><span class="n">tf</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/IntegratorFig3.svg"><img alt="../_images/IntegratorFig3.svg" src="../_images/IntegratorFig3.svg" width="50%" /></a>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="PhaseGuide.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Optimal Control Phase Tutorial</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="ODEGuide.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ODE Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, UA ASRL
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Integrator Tutorial</a><ul>
<li><a class="reference internal" href="#initialization">Initialization</a></li>
<li><a class="reference internal" href="#integration">Integration</a></li>
<li><a class="reference internal" href="#event-detection">Event Detection</a></li>
<li><a class="reference internal" href="#derivatives">Derivatives</a></li>
<li><a class="reference internal" href="#parrallel-integration">Parrallel Integration</a></li>
<li><a class="reference internal" href="#local-control-laws">Local Control Laws</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>